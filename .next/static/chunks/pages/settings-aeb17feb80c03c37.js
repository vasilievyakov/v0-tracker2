(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{2837:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings",function(){return r(2824)}])},2052:function(e,t,r){"use strict";r.d(t,{H:function(){return d},p:function(){return l}});var n=r(2474),s=r.n(n),a=r(3454),i=r(8764).Buffer,o="aes-256-gcm";function c(){var e=a.env.ENCRYPTION_SECRET;if(!e)throw new Error("ENCRYPTION_SECRET environment variable is not set");return s().createHash("sha256").update(e).digest()}function d(e){try{var t=c(),r=s().randomBytes(16),n=s().randomBytes(64),a=s().createCipheriv(o,t,r),d=i.concat([a.update(e,"utf8"),a.final()]),l=a.getAuthTag();return i.concat([n,r,l,d]).toString("base64")}catch(u){throw console.error("Encryption error:",u),new Error("Failed to encrypt data")}}function l(e){try{var t=c(),r=i.from(e,"base64");if(r.length<96)throw new Error("Invalid encrypted data format");r.subarray(0,64);var n=r.subarray(64,80),a=r.subarray(80,96),d=r.subarray(96),l=s().createDecipheriv(o,t,n);return l.setAuthTag(a),i.concat([l.update(d),l.final()]).toString("utf8")}catch(u){throw console.error("Decryption error:",u),new Error("Failed to decrypt data")}}},2038:function(e,t,r){"use strict";r.d(t,{e:function(){return a}});var n=r(5725),s=r(3454);function a(){return(0,n.eI)(s.env.NEXT_PUBLIC_SUPABASE_URL,s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}},2824:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return X}});var n=r(7568),s=r(7582),a=r(5893),i=r(7294),o=r(1799),c=r(9396),d=r(9534),l=r(512),u=r(8388);function h(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,u.m6)((0,l.W)(t))}var p=function(e){var t=e.variant,r=void 0===t?"default":t,n=e.size,s=void 0===n?"default":n;return h("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",{"bg-primary text-primary-foreground hover:bg-primary/90":"default"===r,"bg-destructive text-destructive-foreground hover:bg-destructive/90":"destructive"===r,"border border-input hover:bg-accent hover:text-accent-foreground":"outline"===r,"bg-secondary text-secondary-foreground hover:bg-secondary/80":"secondary"===r,"hover:bg-accent hover:text-accent-foreground":"ghost"===r,"underline-offset-4 hover:underline text-primary":"link"===r},{"h-10 py-2 px-4":"default"===s,"h-9 px-3 rounded-md":"sm"===s,"h-11 px-8 rounded-md":"lg"===s,"h-10 w-10":"icon"===s},e.className)},f=i.forwardRef((function(e,t){var r=e.className,n=e.variant,s=e.size,l=e.asChild,u=e.children,f=(0,d.Z)(e,["className","variant","size","asChild","children"]),m=l?"span":"button";return l&&i.isValidElement(u)?i.cloneElement(u,(0,o.Z)({className:h(p({variant:n,size:s,className:r}),u.props.className),ref:t},f)):(0,a.jsx)(m,(0,c.Z)((0,o.Z)({className:p({variant:n,size:s,className:r}),ref:t},f),{children:u}))}));function m(e){var t=e.className,r=e.type,n=(0,d.Z)(e,["className","type"]);return(0,a.jsx)("input",(0,o.Z)({type:r,"data-slot":"input",className:h("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t)},n))}f.displayName="Button";var v=r(3768);function x(e){var t=e.className,r=(0,d.Z)(e,["className"]);return(0,a.jsx)(v.f,(0,o.Z)({"data-slot":"label",className:h("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t)},r))}function g(e){var t=e.className,r=(0,d.Z)(e,["className"]);return(0,a.jsx)("div",(0,o.Z)({"data-slot":"card",className:h("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t)},r))}function b(e){var t=e.className,r=(0,d.Z)(e,["className"]);return(0,a.jsx)("div",(0,o.Z)({"data-slot":"card-header",className:h("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t)},r))}function y(e){var t=e.className,r=(0,d.Z)(e,["className"]);return(0,a.jsx)("div",(0,o.Z)({"data-slot":"card-title",className:h("leading-none font-semibold",t)},r))}function N(e){var t=e.className,r=(0,d.Z)(e,["className"]);return(0,a.jsx)("div",(0,o.Z)({"data-slot":"card-description",className:h("text-muted-foreground text-sm",t)},r))}function j(e){var t=e.className,r=(0,d.Z)(e,["className"]);return(0,a.jsx)("div",(0,o.Z)({"data-slot":"card-content",className:h("px-6",t)},r))}var w=r(2670),_=r(2038),Z=r(2052);function E(e,t){return A.apply(this,arguments)}function A(){return(A=(0,n.Z)((function(e,t){var r,n,a,i,o;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:return[4,(0,_.e)()];case 1:r=s.sent(),s.label=2;case 2:return s.trys.push([2,4,,5]),n=(0,Z.H)(e),a=(0,Z.H)(t),[4,r.from("api_settings").upsert({id:1,api_id:n,api_hash:a,updated_at:(new Date).toISOString()})];case 3:return(i=s.sent().error)?(console.error("Error saving API settings:",i),[2,{success:!1,error:i.message}]):[2,{success:!0}];case 4:return o=s.sent(),console.error("Error in saveApiSettings:",o),[2,{success:!1,error:(0,w.Z)(o,Error)?o.message:"Unknown error occurred"}];case 5:return[2]}}))}))).apply(this,arguments)}function S(){return T.apply(this,arguments)}function T(){return(T=(0,n.Z)((function(){var e,t;return(0,s.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),[4,Promise.all([r.e(931),r.e(349),r.e(802)]).then(r.bind(r,4414))];case 1:return[4,(0,n.sent().getTelegramClient)()];case 2:return[4,n.sent().getMe()];case 3:return e=n.sent(),[2,{success:!0,message:"Connected as ".concat(e.firstName||"User"," (").concat(e.id,")")}];case 4:return t=n.sent(),console.error("Error testing API connection:",t),[2,{success:!1,error:(0,w.Z)(t,Error)?t.message:"Connection test failed"}];case 5:return[2]}}))}))).apply(this,arguments)}var C=r(872),I=r(828),P=r(9815),k=0;var O=new Map,F=function(e){if(!O.has(e)){var t=setTimeout((function(){O.delete(e),R({type:"REMOVE_TOAST",toastId:e})}),1e6);O.set(e,t)}},D=[],B={toasts:[]};function R(e){B=function(e,t){switch(t.type){case"ADD_TOAST":return(0,c.Z)((0,o.Z)({},e),{toasts:[t.toast].concat((0,P.Z)(e.toasts)).slice(0,1)});case"UPDATE_TOAST":return(0,c.Z)((0,o.Z)({},e),{toasts:e.toasts.map((function(e){return e.id===t.toast.id?(0,o.Z)({},e,t.toast):e}))});case"DISMISS_TOAST":var r=t.toastId;return r?F(r):e.toasts.forEach((function(e){F(e.id)})),(0,c.Z)((0,o.Z)({},e),{toasts:e.toasts.map((function(e){return e.id===r||void 0===r?(0,c.Z)((0,o.Z)({},e),{open:!1}):e}))});case"REMOVE_TOAST":return void 0===t.toastId?(0,c.Z)((0,o.Z)({},e),{toasts:[]}):(0,c.Z)((0,o.Z)({},e),{toasts:e.toasts.filter((function(e){return e.id!==t.toastId}))})}}(B,e),D.forEach((function(e){e(B)}))}function U(e){var t=(0,C.Z)({},e),r=(k=(k+1)%Number.MAX_SAFE_INTEGER).toString(),n=function(){return R({type:"DISMISS_TOAST",toastId:r})};return R({type:"ADD_TOAST",toast:(0,c.Z)((0,o.Z)({},t),{id:r,open:!0,onOpenChange:function(e){e||n()}})}),{id:r,dismiss:n,update:function(e){return R({type:"UPDATE_TOAST",toast:(0,c.Z)((0,o.Z)({},e),{id:r})})}}}function q(){var e=(0,I.Z)(i.useState(B),2),t=e[0],r=e[1];return i.useEffect((function(){return D.push(r),function(){var e=D.indexOf(r);e>-1&&D.splice(e,1)}}),[t]),(0,c.Z)((0,o.Z)({},t),{toast:U,dismiss:function(e){return R({type:"DISMISS_TOAST",toastId:e})}})}var H=r(1408),M=r(889),Y=r(5594),z=r(1664),V=r.n(z);function X(){var e=(0,i.useState)(!1),t=e[0],r=e[1],o=(0,i.useState)(!1),c=o[0],d=o[1],l=(0,i.useState)("api"),u=l[0],h=l[1],p=(0,i.useState)(""),v=p[0],w=p[1],_=(0,i.useState)(""),Z=_[0],A=_[1],T=(0,i.useState)(""),C=T[0],I=T[1],P=(0,i.useState)(null),k=P[0],O=P[1],F=(0,i.useState)(!1),D=F[0],B=F[1],R=q().toast,U=function(){var e=(0,n.Z)((function(e){var t,n,a,i;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:e.preventDefault(),r(!0),t=new FormData(e.currentTarget),n=t.get("api_id"),a=t.get("api_hash"),s.label=1;case 1:return s.trys.push([1,3,4,5]),[4,E(n,a)];case 2:return(i=s.sent()).success?R({title:"Settings saved",description:"Your Telegram API credentials have been saved."}):R({title:"Error",description:i.error||"Failed to save settings.",variant:"destructive"}),[3,5];case 3:return s.sent(),R({title:"Error",description:"An unexpected error occurred.",variant:"destructive"}),[3,5];case 4:return r(!1),[7];case 5:return[2]}}))}));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=(0,n.Z)((function(){var e;return(0,s.__generator)(this,(function(t){switch(t.label){case 0:d(!0),t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,S()];case 2:return(e=t.sent()).success?R({title:"Connection successful",description:e.message||"Your Telegram API credentials are working correctly."}):R({title:"Connection failed",description:e.error||"Failed to connect to Telegram API.",variant:"destructive"}),[3,5];case 3:return t.sent(),R({title:"Error",description:"An unexpected error occurred.",variant:"destructive"}),[3,5];case 4:return d(!1),[7];case 5:return[2]}}))}));return function(){return e.apply(this,arguments)}}(),X=function(){var e=(0,n.Z)((function(){var e;return(0,s.__generator)(this,(function(t){switch(t.label){case 0:if(!v)return R({title:"Error",description:"Please enter your phone number",variant:"destructive"}),[2];r(!0),t.label=1;case 1:return t.trys.push([1,4,5,6]),[4,fetch("/api/telegram/auth/request-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:v})})];case 2:return[4,t.sent().json()];case 3:return(e=t.sent()).success?(O(e.phoneCodeHash),h("code"),R({title:"Code sent",description:"Please check your Telegram app for the verification code."})):R({title:"Error",description:e.error||"Failed to send verification code",variant:"destructive"}),[3,6];case 4:return t.sent(),R({title:"Error",description:"An unexpected error occurred.",variant:"destructive"}),[3,6];case 5:return r(!1),[7];case 6:return[2]}}))}));return function(){return e.apply(this,arguments)}}(),L=function(){var e=(0,n.Z)((function(){var e;return(0,s.__generator)(this,(function(t){switch(t.label){case 0:if(!Z||!k)return R({title:"Error",description:"Please enter the verification code",variant:"destructive"}),[2];r(!0),t.label=1;case 1:return t.trys.push([1,4,5,6]),[4,fetch("/api/telegram/auth/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:v,phoneCodeHash:k,code:Z,password:D?C:void 0})})];case 2:return[4,t.sent().json()];case 3:return(e=t.sent()).success?(h("completed"),R({title:"Authentication successful",description:"You have successfully authenticated with Telegram."})):e.requiresPassword?(B(!0),h("password"),R({title:"2FA Required",description:"Please enter your 2FA password"})):R({title:"Error",description:e.error||"Failed to sign in",variant:"destructive"}),[3,6];case 4:return t.sent(),R({title:"Error",description:"An unexpected error occurred.",variant:"destructive"}),[3,6];case 5:return r(!1),[7];case 6:return[2]}}))}));return function(){return e.apply(this,arguments)}}();return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(H.Z,{className:"h-8 w-8 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-balance",children:"Settings"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Configure your Telegram API credentials and authenticate"})]})]}),(0,a.jsx)(V(),{href:"/",children:(0,a.jsx)(f,{variant:"outline",children:"Back to Dashboard"})})]}),(0,a.jsxs)("div",{className:"space-y-6 max-w-2xl",children:[(0,a.jsxs)(g,{children:[(0,a.jsxs)(b,{children:[(0,a.jsx)(y,{children:"Telegram API Configuration"}),(0,a.jsxs)(N,{children:["Enter your Telegram API credentials to automatically fetch channel data. Get your API ID and Hash from"," ",(0,a.jsx)("a",{href:"https://my.telegram.org",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"my.telegram.org"})]})]}),(0,a.jsx)(j,{children:(0,a.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(x,{htmlFor:"api_id",children:"API ID"}),(0,a.jsx)(m,{id:"api_id",name:"api_id",type:"number",placeholder:"12345678",required:!0})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(x,{htmlFor:"api_hash",children:"API Hash"}),(0,a.jsx)(m,{id:"api_hash",name:"api_hash",placeholder:"0123456789abcdef0123456789abcdef",required:!0})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(f,{type:"submit",disabled:t,children:[t&&(0,a.jsx)(M.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Settings"]}),(0,a.jsxs)(f,{type:"button",variant:"outline",onClick:z,disabled:c,children:[c&&(0,a.jsx)(M.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Test Connection"]})]})]})})]}),(0,a.jsxs)(g,{children:[(0,a.jsxs)(b,{children:[(0,a.jsx)(y,{children:"Telegram Authentication"}),(0,a.jsx)(N,{children:"Authenticate with your Telegram account to enable channel data collection"})]}),(0,a.jsxs)(j,{className:"space-y-4",children:["api"===u&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"First, save your API credentials above, then proceed with authentication."}),(0,a.jsx)(f,{onClick:function(){return h("phone")},disabled:t,className:"w-full",children:"Start Authentication"})]}),"phone"===u&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(x,{htmlFor:"phone",children:"Phone Number"}),(0,a.jsx)(m,{id:"phone",type:"tel",placeholder:"+1234567890",value:v,onChange:function(e){return w(e.target.value)},required:!0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Enter your phone number in international format (e.g., +1234567890)"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(f,{onClick:X,disabled:t||!v,className:"flex-1",children:[t&&(0,a.jsx)(M.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Send Code"]}),(0,a.jsx)(f,{variant:"outline",onClick:function(){return h("api")},disabled:t,children:"Back"})]})]}),"code"===u&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(x,{htmlFor:"code",children:"Verification Code"}),(0,a.jsx)(m,{id:"code",type:"text",placeholder:"12345",value:Z,onChange:function(e){return A(e.target.value)},required:!0,maxLength:6}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Enter the verification code sent to your Telegram app"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(f,{onClick:L,disabled:t||!Z,className:"flex-1",children:[t&&(0,a.jsx)(M.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Verify Code"]}),(0,a.jsx)(f,{variant:"outline",onClick:function(){h("phone"),A(""),O(null)},disabled:t,children:"Back"})]})]}),"password"===u&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(x,{htmlFor:"password",children:"2FA Password"}),(0,a.jsx)(m,{id:"password",type:"password",placeholder:"Enter your 2FA password",value:C,onChange:function(e){return I(e.target.value)},required:!0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Enter your two-factor authentication password"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(f,{onClick:L,disabled:t||!C,className:"flex-1",children:[t&&(0,a.jsx)(M.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Authenticate"]}),(0,a.jsx)(f,{variant:"outline",onClick:function(){h("code"),I(""),B(!1)},disabled:t,children:"Back"})]})]}),"completed"===u&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-green-600",children:[(0,a.jsx)(Y.Z,{className:"h-5 w-5"}),(0,a.jsx)("p",{className:"font-medium",children:"Authentication successful!"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"You are now authenticated with Telegram. You can start adding channels."}),(0,a.jsx)(f,{variant:"outline",onClick:function(){h("api"),w(""),A(""),I(""),O(null),B(!1)},children:"Reset Authentication"})]})]})]})]})]})})}}},function(e){e.O(0,[714,525,774,888,179],(function(){return t=2837,e(e.s=t);var t}));var t=e.O();_N_E=t}]);