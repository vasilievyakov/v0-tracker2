(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[524],{4414:function(e,t,n){"use strict";n.r(t),n.d(t,{fetchChannelData:function(){return k},getTelegramClient:function(){return _},initializeTelegramAuth:function(){return A}});var r=n(7568),s=n(2670),a=n(9815),i=n(7582),o=n(9769),c=n(7247),u=n(8349),l=n(2038),h=n(2052),p=null,d=!1;function f(){return m.apply(this,arguments)}function m(){return(m=(0,r.Z)((function(){var e,t,n,r;return(0,i.__generator)(this,(function(s){switch(s.label){case 0:return[4,(0,l.e)()];case 1:return[4,s.sent().from("api_settings").select("api_id, api_hash").eq("id",1).maybeSingle()];case 2:if(e=s.sent(),!(t=e.data)||!t.api_id||!t.api_hash)throw new Error("API credentials not found. Please configure them in settings.");if(n=parseInt((0,h.p)(t.api_id)),r=(0,h.p)(t.api_hash),isNaN(n)||!r)throw new Error("Invalid API credentials format.");return[2,{apiId:n,apiHash:r}]}}))}))).apply(this,arguments)}function g(){return w.apply(this,arguments)}function w(){return(w=(0,r.Z)((function(){var e,t;return(0,i.__generator)(this,(function(n){switch(n.label){case 0:return[4,(0,l.e)()];case 1:return[4,n.sent().from("telegram_sessions").select("session_string").eq("id",1).maybeSingle()];case 2:if(e=n.sent(),!(t=e.data)||!t.session_string)return[2,null];try{return[2,(0,h.p)(t.session_string)]}catch(r){return console.error("Failed to decrypt session:",r),[2,null]}return[2]}}))}))).apply(this,arguments)}function y(e,t){return b.apply(this,arguments)}function b(){return(b=(0,r.Z)((function(e,t){var n,r,s;return(0,i.__generator)(this,(function(a){switch(a.label){case 0:return[4,(0,l.e)()];case 1:return n=a.sent(),r=(0,h.H)(e),[4,n.from("telegram_sessions").upsert({id:1,session_string:r,phone_number:t||null,updated_at:(new Date).toISOString()})];case 2:if(s=a.sent().error)throw new Error("Failed to save session: ".concat(s.message));return[2]}}))}))).apply(this,arguments)}function _(){return v.apply(this,arguments)}function v(){return(v=(0,r.Z)((function(){var e,t,n,r,s;return(0,i.__generator)(this,(function(a){switch(a.label){case 0:return p&&p.connected?[2,p]:d?[4,new Promise((function(e){return setTimeout(e,1e3)}))]:[3,2];case 1:return a.sent(),[2,_()];case 2:d=!0,a.label=3;case 3:return a.trys.push([3,9,10,11]),[4,f()];case 4:return e=a.sent(),[4,g()];case 5:return t=a.sent(),n=new c.StringSession(t||""),(r=new o.TelegramClient(n,e.apiId,e.apiHash,{connectionRetries:5})).connected?[3,7]:[4,r.connect()];case 6:a.sent(),a.label=7;case 7:if(!t)throw new Error("No session found. Please authenticate first.");return[4,r.checkAuthorization()];case 8:if(!a.sent())throw new Error("Session expired. Please re-authenticate.");return p=r,[2,r];case 9:throw s=a.sent(),console.error("Error initializing Telegram client:",s),s;case 10:return d=!1,[7];case 11:return[2]}}))}))).apply(this,arguments)}function A(e,t,n){return C.apply(this,arguments)}function C(){return(C=(0,r.Z)((function(e,t,n){var r,s,a,l,h,p,d,m,g;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return[4,f()];case 1:return r=i.sent(),s=new c.StringSession(""),[4,(a=new o.TelegramClient(s,r.apiId,r.apiHash,{connectionRetries:5})).connect()];case 2:i.sent(),i.label=3;case 3:return i.trys.push([3,,15,17]),[4,a.sendCode({apiId:r.apiId,apiHash:r.apiHash},e)];case 4:return l=i.sent(),h=l.phoneCodeHash,[4,t(h)];case 5:p=i.sent(),i.label=6;case 6:return i.trys.push([6,8,,13]),[4,a.invoke(new u.Api.auth.SignIn({phoneNumber:e,phoneCodeHash:h,phoneCode:p}))];case 7:return i.sent(),[3,13];case 8:return"SESSION_PASSWORD_NEEDED"===(d=i.sent()).errorMessage&&n?[4,n()]:[3,12];case 9:return i.sent(),[4,a.invoke(new u.Api.account.GetPassword)];case 10:return i.sent(),[4,a.invoke(new u.Api.account.GetPassword)];case 11:throw m=i.sent(),m.srpId,m.currentAlgo,m.srpB,new Error("2FA password verification requires additional implementation");case 12:throw d;case 13:return[4,y(g=a.session.save(),e)];case 14:return i.sent(),[2,g];case 15:return[4,a.disconnect()];case 16:return i.sent(),[7];case 17:return[2]}}))}))).apply(this,arguments)}function k(e){return I.apply(this,arguments)}function I(){return I=(0,r.Z)((function(e){var t,n,r,o,c,l,h,p,d,f,m,g,w,y,b,v,A,C,k,I,S,E,Z,D,M=arguments;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return t=M.length>1&&void 0!==M[1]?M[1]:"month",[4,_()];case 1:n=i.sent(),i.label=2;case 2:return i.trys.push([2,8,,9]),[4,n.invoke(new u.Api.contacts.ResolveUsername({username:e.replace("@","")}))];case 3:if(r=i.sent(),!(0,s.Z)(r.chats[0],u.Api.Channel))throw new Error("Resolved entity is not a channel");return o=r.chats[0],c=o.id,[4,n.invoke(new u.Api.channels.GetFullChannel({channel:c}))];case 4:switch(l=i.sent(),h=l.fullChat,p=l.chats[0],t){case"all":d=63072e6;break;case"year":d=31536e6;break;case"month":default:d=2592e6;break;case"update":d=6048e5}f=Math.floor((Date.now()-d)/1e3),m=[],g=0,w=!0,y="all"===t?100:"year"===t?50:"month"===t?30:10,i.label=5;case 5:return w&&m.length<y?[4,n.invoke(new u.Api.channels.GetHistory({channel:c,offsetId:g,offsetDate:f,addOffset:0,limit:100,maxId:0,minId:0,hash:BigInt(0)}))]:[3,7];case 6:return v=i.sent(),0===(A=v.messages.filter((function(e){return(0,s.Z)(e,u.Api.Message)}))).length?(w=!1,[3,7]):((b=m).push.apply(b,(0,a.Z)(A)),A[A.length-1].date<f?(w=!1,[3,7]):(g=A[A.length-1].id,[3,5]));case 7:return C=m.filter((function(e){return e.message&&e.message.length>0})).slice(0,y).map((function(t){var n=t.views||0,r=t.reactions?Array.from(t.reactions.results||[]).reduce((function(e,t){return e+(t.count||0)}),0):0,a=t.forwards||0,i=t.replies&&t.replies.replies||0,o=n>0?((n+r+a+i)/n*100).toFixed(2):"0.00",c=(0,s.Z)(t.media,u.Api.MessageMediaPhoto)||(0,s.Z)(t.media,u.Api.MessageMediaDocument),l=null;if((0,s.Z)(t.media,u.Api.MessageMediaPhoto))l="photo";else if((0,s.Z)(t.media,u.Api.MessageMediaDocument)){var h=t.media.document;if((0,s.Z)(h,u.Api.Document)){var p=!0,d=!1,f=void 0;try{for(var m,g=h.attributes[Symbol.iterator]();!(p=(m=g.next()).done);p=!0){var w=m.value;if((0,s.Z)(w,u.Api.DocumentAttributeVideo)){l="video";break}if((0,s.Z)(w,u.Api.DocumentAttributeAudio)){l="audio";break}}}catch(y){d=!0,f=y}finally{try{p||null==g.return||g.return()}finally{if(d)throw f}}}}return{postId:t.id.toString(),content:t.message||"",postUrl:"https://t.me/".concat(e.replace("@",""),"/").concat(t.id),viewsCount:n,reactionsCount:r,commentsCount:i,forwardsCount:a,engagementRate:parseFloat(o),publishedAt:new Date(1e3*t.date).toISOString(),hasMedia:c,mediaType:l}})),k=p.about||"",I=p.title||e,S="".concat(I," ").concat(k).toLowerCase(),E="Other",S.match(/tech|ai|software|coding|programming|developer/)?E="Technology":S.match(/news|breaking|world|politics/)?E="News":S.match(/crypto|bitcoin|blockchain|defi|web3/)?E="Crypto":S.match(/business|finance|economy|market/)?E="Business":S.match(/education|learning|course|tutorial/)?E="Education":S.match(/entertainment|music|movie|game/)&&(E="Entertainment"),Z="English",/[\u0430-\u044f\u0410-\u042f\u0451\u0401]/.test(S)&&(Z="Russian"),[2,{title:I,subscribers:h.participantsCount||0,description:k||null,category:E,language:Z,posts:C}];case 8:throw D=i.sent(),console.error("Error fetching channel data:",D),D;case 9:return[2]}}))})),I.apply(this,arguments)}},5644:function(){}}]);