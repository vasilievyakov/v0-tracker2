"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[210],{5739:function(e,t,n){n.d(t,{z:function(){return d}});var r=n(1799),s=n(9534),a=n(5893),o=(n(7294),n(8426)),i=n(2003),c=n(2461),u=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function d(e){var t=e.className,n=e.variant,i=e.size,d=e.asChild,l=void 0!==d&&d,p=(0,s.Z)(e,["className","variant","size","asChild"]),f=l?o.g7:"button";return(0,a.jsx)(f,(0,r.Z)({"data-slot":"button",className:(0,c.cn)(u({variant:n,size:i,className:t}))},p))}},4345:function(e,t,n){n.d(t,{Ol:function(){return c},SZ:function(){return d},Zb:function(){return i},aY:function(){return l},ll:function(){return u}});var r=n(1799),s=n(9534),a=n(5893),o=(n(7294),n(2461));function i(e){var t=e.className,n=(0,s.Z)(e,["className"]);return(0,a.jsx)("div",(0,r.Z)({"data-slot":"card",className:(0,o.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t)},n))}function c(e){var t=e.className,n=(0,s.Z)(e,["className"]);return(0,a.jsx)("div",(0,r.Z)({"data-slot":"card-header",className:(0,o.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t)},n))}function u(e){var t=e.className,n=(0,s.Z)(e,["className"]);return(0,a.jsx)("div",(0,r.Z)({"data-slot":"card-title",className:(0,o.cn)("leading-none font-semibold",t)},n))}function d(e){var t=e.className,n=(0,s.Z)(e,["className"]);return(0,a.jsx)("div",(0,r.Z)({"data-slot":"card-description",className:(0,o.cn)("text-muted-foreground text-sm",t)},n))}function l(e){var t=e.className,n=(0,s.Z)(e,["className"]);return(0,a.jsx)("div",(0,r.Z)({"data-slot":"card-content",className:(0,o.cn)("px-6",t)},n))}},2685:function(e,t,n){n.d(t,{I:function(){return i}});var r=n(1799),s=n(9534),a=n(5893),o=(n(7294),n(2461));function i(e){var t=e.className,n=e.type,i=(0,s.Z)(e,["className","type"]);return(0,a.jsx)("input",(0,r.Z)({type:n,"data-slot":"input",className:(0,o.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t)},i))}},3223:function(e,t,n){n.d(t,{_:function(){return c}});var r=n(1799),s=n(9534),a=n(5893),o=(n(7294),n(9102)),i=n(2461);function c(e){var t=e.className,n=(0,s.Z)(e,["className"]);return(0,a.jsx)(o.f,(0,r.Z)({"data-slot":"label",className:(0,i.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t)},n))}},767:function(e,t,n){n.d(t,{pm:function(){return m}});var r=n(872),s=n(1799),a=n(9396),o=n(828),i=n(9815),c=n(7294),u=0;var d=new Map,l=function(e){if(!d.has(e)){var t=setTimeout((function(){d.delete(e),g({type:"REMOVE_TOAST",toastId:e})}),1e6);d.set(e,t)}},p=[],f={toasts:[]};function g(e){f=function(e,t){switch(t.type){case"ADD_TOAST":return(0,a.Z)((0,s.Z)({},e),{toasts:[t.toast].concat((0,i.Z)(e.toasts)).slice(0,1)});case"UPDATE_TOAST":return(0,a.Z)((0,s.Z)({},e),{toasts:e.toasts.map((function(e){return e.id===t.toast.id?(0,s.Z)({},e,t.toast):e}))});case"DISMISS_TOAST":var n=t.toastId;return n?l(n):e.toasts.forEach((function(e){l(e.id)})),(0,a.Z)((0,s.Z)({},e),{toasts:e.toasts.map((function(e){return e.id===n||void 0===n?(0,a.Z)((0,s.Z)({},e),{open:!1}):e}))});case"REMOVE_TOAST":return void 0===t.toastId?(0,a.Z)((0,s.Z)({},e),{toasts:[]}):(0,a.Z)((0,s.Z)({},e),{toasts:e.toasts.filter((function(e){return e.id!==t.toastId}))})}}(f,e),p.forEach((function(e){e(f)}))}function h(e){var t=(0,r.Z)({},e),n=(u=(u+1)%Number.MAX_SAFE_INTEGER).toString(),o=function(){return g({type:"DISMISS_TOAST",toastId:n})};return g({type:"ADD_TOAST",toast:(0,a.Z)((0,s.Z)({},t),{id:n,open:!0,onOpenChange:function(e){e||o()}})}),{id:n,dismiss:o,update:function(e){return g({type:"UPDATE_TOAST",toast:(0,a.Z)((0,s.Z)({},e),{id:n})})}}}function m(){var e=(0,o.Z)(c.useState(f),2),t=e[0],n=e[1];return c.useEffect((function(){return p.push(n),function(){var e=p.indexOf(n);e>-1&&p.splice(e,1)}}),[t]),(0,a.Z)((0,s.Z)({},t),{toast:h,dismiss:function(e){return g({type:"DISMISS_TOAST",toastId:e})}})}},6209:function(e,t,n){n.d(t,{cY:function(){return u},ce:function(){return h},yV:function(){return f}});var r=n(7568),s=n(2670),a=n(7582),o=n(2038),i=n(2052);function c(e){var t=e.replace("@","");return t.includes("t.me/")&&(t=t.split("t.me/")[1].split("/")[0].split("?")[0]),t=t.split("/")[0].split("?")[0]}function u(e){return d.apply(this,arguments)}function d(){return d=(0,r.Z)((function(e){var t,n,r,i,u,d,p=arguments;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return t=p.length>1&&void 0!==p[1]?p[1]:"month",[4,(0,o.e)()];case 1:n=a.sent(),a.label=2;case 2:return a.trys.push([2,5,,6]),console.log("[v0] [SERVER] Starting addChannelByUrl for:",e,"timeRange:",t),r=c(e),console.log("[v0] [SERVER] Extracted username:",r),r?[4,n.from("channels").select("id").eq("channel_username",r).maybeSingle()]:(console.log("[v0] [SERVER] Invalid username extracted"),[2,{success:!1,error:"Invalid channel URL format"}]);case 3:return i=a.sent(),u=i.data,console.log("[v0] [SERVER] Existing channel check:",u?"found":"not found"),u&&"update"!==t?(console.log("[v0] [SERVER] Channel exists, returning error"),[2,{success:!1,error:"Channel already exists. Use 'Update' mode to fetch new posts."}]):[4,l({username:r,timeRange:t,channelId:null===u||void 0===u?void 0:u.id,jobType:u&&"update"===t?"update_channel":"add_channel"})];case 4:return[2,a.sent()];case 5:return d=a.sent(),console.error("[v0] [SERVER] Error in addChannelByUrl:",d),[2,{success:!1,error:(0,s.Z)(d,Error)?d.message:"Unknown error occurred"}];case 6:return[2]}}))})),d.apply(this,arguments)}function l(e){return p.apply(this,arguments)}function p(){return(p=(0,r.Z)((function(e){var t,r,i,c,u,d,l,p,f,g,h,m,v,b,_,y,E,w,x,Z;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return[4,(0,o.e)()];case 1:t=a.sent(),r=e.username,i=e.timeRange,c=e.channelId,u=e.jobType,a.label=2;case 2:return a.trys.push([2,13,,14]),[4,Promise.all([n.e(931),n.e(349),n.e(524)]).then(n.bind(n,4414))];case 3:return[4,(0,a.sent().fetchChannelData)(r,i)];case 4:return d=a.sent(),"update_channel"===u&&c?[4,t.from("posts").select("post_id").eq("channel_id",c)]:[3,8];case 5:return l=a.sent(),p=l.data,f=new Set((null===p||void 0===p?void 0:p.map((function(e){return e.post_id})))||[]),(g=d.posts.filter((function(e){return!f.has(e.postId)}))).length>0?(h=g.map((function(e){return{channel_id:c,post_id:e.postId,channel_username:r,content:e.content,post_url:e.postUrl,views_count:e.viewsCount||0,reactions_count:e.reactionsCount||0,comments_count:e.commentsCount||0,forwards_count:e.forwardsCount||0,engagement_rate:e.engagementRate,published_at:e.publishedAt,has_media:e.hasMedia||!1,media_type:e.mediaType}})),[4,t.from("posts").insert(h)]):[3,7];case 6:if(m=a.sent(),v=m.error)throw new Error("Failed to insert posts: "+v.message);a.label=7;case 7:return[2,{success:!0,message:"Channel updated successfully. Added ".concat(g.length," new posts."),postsAdded:g.length}];case 8:return[4,t.from("channels").insert({channel_name:d.title,channel_url:"https://t.me/".concat(r),channel_username:r,subscribers_count:d.subscribers||0,description:d.description||null,category:d.category||"Other",language:d.language||"Unknown"}).select().single()];case 9:if(b=a.sent(),_=b.data,y=b.error)throw new Error("Failed to add channel: "+y.message);return d.posts&&d.posts.length>0?(E=d.posts.map((function(e){return{channel_id:_.id,post_id:e.postId,channel_username:r,content:e.content,post_url:e.postUrl,views_count:e.viewsCount||0,reactions_count:e.reactionsCount||0,comments_count:e.commentsCount||0,forwards_count:e.forwardsCount||0,engagement_rate:e.engagementRate,published_at:e.publishedAt,has_media:e.hasMedia||!1,media_type:e.mediaType}})),[4,t.from("posts").insert(E)]):[3,11];case 10:w=a.sent(),(x=w.error)&&console.error("[v0] [SYNC] Error inserting posts:",x),a.label=11;case 11:return[2,{success:!0,message:"Channel added successfully with ".concat(d.posts.length," posts."),channelId:_.id,postsAdded:d.posts.length}];case 12:return[3,14];case 13:return Z=a.sent(),console.error("[v0] [SYNC] Error processing channel:",Z),[2,{success:!1,error:(0,s.Z)(Z,Error)?Z.message:"Unknown error occurred"}];case 14:return[2]}}))}))).apply(this,arguments)}function f(e,t){return g.apply(this,arguments)}function g(){return(g=(0,r.Z)((function(e,t){var n,r,c,u,d;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return[4,(0,o.e)()];case 1:n=a.sent(),a.label=2;case 2:return a.trys.push([2,4,,5]),r=(0,i.H)(e),c=(0,i.H)(t),[4,n.from("api_settings").upsert({id:1,api_id:r,api_hash:c,updated_at:(new Date).toISOString()})];case 3:return(u=a.sent().error)?(console.error("Error saving API settings:",u),[2,{success:!1,error:u.message}]):[2,{success:!0}];case 4:return d=a.sent(),console.error("Error in saveApiSettings:",d),[2,{success:!1,error:(0,s.Z)(d,Error)?d.message:"Unknown error occurred"}];case 5:return[2]}}))}))).apply(this,arguments)}function h(){return m.apply(this,arguments)}function m(){return(m=(0,r.Z)((function(){var e,t;return(0,a.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),[4,Promise.all([n.e(931),n.e(349),n.e(524)]).then(n.bind(n,4414))];case 1:return[4,(0,r.sent().getTelegramClient)()];case 2:return[4,r.sent().getMe()];case 3:return e=r.sent(),[2,{success:!0,message:"Connected as ".concat(e.firstName||"User"," (").concat(e.id,")")}];case 4:return t=r.sent(),console.error("Error testing API connection:",t),[2,{success:!1,error:(0,s.Z)(t,Error)?t.message:"Connection test failed"}];case 5:return[2]}}))}))).apply(this,arguments)}},2052:function(e,t,n){n.d(t,{H:function(){return u},p:function(){return d}});var r=n(2474),s=n.n(r),a=n(4155),o=n(8764).Buffer,i="aes-256-gcm";function c(){var e=a.env.ENCRYPTION_SECRET;if(!e)throw new Error("ENCRYPTION_SECRET environment variable is not set");return s().createHash("sha256").update(e).digest()}function u(e){try{var t=c(),n=s().randomBytes(16),r=s().randomBytes(64),a=s().createCipheriv(i,t,n),u=o.concat([a.update(e,"utf8"),a.final()]),d=a.getAuthTag();return o.concat([r,n,d,u]).toString("base64")}catch(l){throw console.error("Encryption error:",l),new Error("Failed to encrypt data")}}function d(e){try{var t=c(),n=o.from(e,"base64");if(n.length<96)throw new Error("Invalid encrypted data format");n.subarray(0,64);var r=n.subarray(64,80),a=n.subarray(80,96),u=n.subarray(96),d=s().createDecipheriv(i,t,r);return d.setAuthTag(a),o.concat([d.update(u),d.final()]).toString("utf8")}catch(l){throw console.error("Decryption error:",l),new Error("Failed to decrypt data")}}},2038:function(e,t,n){n.d(t,{e:function(){return a}});var r=n(5725),s=n(4155);function a(){return(0,r.eI)(s.env.NEXT_PUBLIC_SUPABASE_URL,s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}},2461:function(e,t,n){n.d(t,{cn:function(){return a}});var r=n(512),s=n(8388);function a(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,s.m6)((0,r.W)(t))}}}]);